<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= appName %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-tasks"></i> <%= appName %></h1>
                <p class="subtitle">Organize your daily tasks efficiently</p>
            </div>
        </header>

        <!-- Stats Card -->
        <div class="stats-card">
            <div class="stat">
                <span class="stat-label">Total Tasks</span>
                <span class="stat-value" id="totalTasks"><%= tasks.length %></span>
            </div>
            <div class="stat">
                <span class="stat-label">Completed</span>
                <span class="stat-value completed" id="completedTasks"><%= tasks.filter(t => t.done).length %></span>
            </div>
            <div class="stat">
                <span class="stat-label">Pending</span>
                <span class="stat-value pending" id="pendingTasks"><%= tasks.filter(t => !t.done).length %></span>
            </div>
        </div>

        <!-- Add Task Section -->
        <div class="add-task-section">
            <form action="/add" method="POST" class="add-task-form" id="addTaskForm">
                <div class="input-group">
                    <input 
                        type="text" 
                        name="text" 
                        placeholder="Add a new task..." 
                        class="task-input"
                        maxlength="200"
                        required
                    >
                    <input 
                        type="datetime-local" 
                        name="alarmTime" 
                        class="alarm-input"
                        title="Set alarm time (optional)"
                    >
                    <button type="submit" class="btn-add">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </div>
                <small class="char-count">0/200</small>
            </form>
        </div>

        <!-- Tasks List -->
        <div class="tasks-section">
            <% if (tasks.length === 0) { %>
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <h3>No tasks yet</h3>
                    <p>Add your first task to get started!</p>
                </div>
            <% } else { %>
                <div class="tasks-list">
                    <% tasks.forEach(task => { %>
                        <div class="task-item <%= task.done ? 'completed' : '' %> <%= task.alarmTime ? 'has-alarm' : '' %>" data-task-id="<%= task.id %>" data-task-text="<%= task.text %>" data-task-alarm="<%= task.alarmTime || '' %>">
                            <form action="/toggle/<%= task.id %>" method="POST" class="toggle-form">
                                <input 
                                    type="checkbox" 
                                    class="task-checkbox" 
                                    <%= task.done ? 'checked' : '' %>
                                    onchange="this.form.submit()"
                                >
                            </form>
                            <div class="task-content">
                                <span class="task-text"><%= task.text %></span>
                                <% if (task.alarmTime) { %>
                                    <span class="alarm-badge" data-time="<%= task.alarmTime %>">
                                        <i class="fas fa-bell"></i> 
                                        <% 
                                            const alarmDate = new Date(task.alarmTime);
                                            let hours = alarmDate.getHours();
                                            const mins = String(alarmDate.getMinutes()).padStart(2, '0');
                                            const day = String(alarmDate.getDate()).padStart(2, '0');
                                            const month = String(alarmDate.getMonth() + 1).padStart(2, '0');
                                            const ampm = hours >= 12 ? 'PM' : 'AM';
                                            hours = hours % 12 || 12;
                                            const display12h = String(hours).padStart(2, '0');
                                        %>
                                        <%= day %>/<%= month %> <%= display12h %>:<%= mins %> <%= ampm %>
                                    </span>
                                <% } %>
                            </div>
                            <div class="task-actions">
                                <button class="btn-edit" onclick="openEditModal(this)" title="Edit task">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <form action="/delete/<%= task.id %>" method="POST" class="delete-form">
                                    <button type="submit" class="btn-delete" title="Delete task">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    <% }); %>
                </div>

                <!-- Clear All Button -->
                <div class="clear-section">
                    <form action="/clear" method="POST" id="clearForm" onsubmit="return confirm('Are you sure you want to clear all tasks?')">
                        <button type="submit" class="btn-clear">
                            <i class="fas fa-broom"></i> Clear All Tasks
                        </button>
                    </form>
                </div>
            <% } %>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 <%= appName %>. All rights reserved.</p>
    </footer>

    <!-- Alarm Popup Modal -->
    <div id="alarmModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-bell modal-icon"></i>
                <h2>Task Reminder!</h2>
                <button class="modal-close" onclick="closeAlarmModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="alarmTaskText"></p>
                <p class="alarm-time-display" id="alarmTimeDisplay"></p>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-secondary" onclick="closeAlarmModal()">Dismiss</button>
                <button class="btn-modal btn-modal-primary" onclick="completeAlarmTask()">Mark Done</button>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div id="editModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-pencil-alt modal-icon"></i>
                <h2>Edit Task</h2>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <form id="editForm" action="/edit/0" method="POST">
                <div class="modal-body edit-modal-body">
                    <div class="form-group">
                        <label for="editTaskText">Task Description</label>
                        <input 
                            type="text" 
                            id="editTaskText" 
                            name="text" 
                            class="form-input"
                            maxlength="200"
                            required
                        >
                        <small class="char-count-edit">0/200</small>
                    </div>
                    <div class="form-group">
                        <label for="editAlarmTime">Alarm Time (Optional)</label>
                        <input 
                            type="datetime-local" 
                            id="editAlarmTime" 
                            name="alarmTime" 
                            class="form-input"
                        >
                        <small class="alarm-info">Leave empty to remove alarm</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-modal btn-modal-secondary" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="btn-modal btn-modal-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/main.js"></script>
</body>
</html>
